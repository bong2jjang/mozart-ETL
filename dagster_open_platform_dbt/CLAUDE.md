# dbt 프로젝트 개요

이 문서는 dbt 프로젝트의 구조, 목적, 모범 사례를 설명합니다.
LLM 기반 문서화, 쿼리 생성, 분석 지원을 위한 참고 자료입니다.

---

## 1. 스테이징 레이어 (Staging)
- **목적:** 새로운 원시 데이터를 추가합니다.
- **구성:** 데이터 소스별 하위 디렉토리 (예: Google Search Console, LinkedIn Ads, Salesforce, Reddit Ads 등).
- **처리:**
  - 최소한의 변환만 수행합니다.
  - 주로 **필드 이름 변경** 위주입니다.
  - 이 단계에서는 추가적인 로직을 적용하지 않습니다.
- **모범 사례:** 새 파일을 생성하기 전에 **기존 파일이 있는지 확인**하여 중복을 방지합니다.

---

## 2. 모델 레이어 (Models)
- **목적:** 컨텍스트와 재사용 가능한 로직을 추가합니다.
- **특성:** 일반적으로 스테이징 레이어와 **1:1 관계**입니다.
- **처리:**
  - **CASE 문** 및 기타 재사용 가능한 로직을 추가합니다.
  - 불필요한 데이터를 제외하기 위한 **필터**를 적용합니다.
- **출력:** **코어 레이어**로 전달됩니다.
- **모범 사례:** 새 파일을 생성하기 전에 **기존 파일이 있는지 확인**하여 중복을 방지합니다.

---

## 3. 코어 레이어 (Core)
- **목적:** **차원(dimension) 테이블과 팩트(fact) 테이블**을 생성합니다.
- **처리:**
  - 데이터를 통합하고 표준화합니다.
  - 다운스트림 레이어에서 재사용할 수 있도록 합니다.
- **출력:** **리포팅 레이어**로 전달됩니다.

---

## 4. DWH 리포팅 레이어 (Reporting)
- **목적:** 리포팅 및 분석을 위한 **최종 큐레이션된 데이터**를 제공합니다.
- **접근:**
  - 이것이 **최종 사용자에게 노출되는 지표**입니다.
  - 다른 레이어는 **직접 노출되지 않습니다**.
- **유지보수:**
  - 여기 파일이 업데이트되면 **관련 YAML 파일도 반드시 업데이트**해야 합니다.
  - YAML의 컬럼 정의는 **LLM과 BI 도구 모두에 반영**되어 시스템 간 일관된 정의를 보장합니다.
- **모범 사례:** 새 테이블을 만드는 대신 **기존 테이블에 새 컬럼을 추가**하는 것을 선호합니다. **데이터 그레인(grain)이나 주제**가 새 테이블을 정당화하는 경우에만 생성합니다.

---

## 일반 규칙
- 조인할 때는 **한 레이어 아래**로만 조인하는 것을 선호합니다.
- 리포팅 레이어 모델이 변경되면 **YAML 파일을 업데이트**합니다.
- 컬럼 정의는 LLM + BI 도구와 동기화를 유지해야 합니다.

---

## 제한 영역 (새 파일 추가 금지)
- **Intermediate 레이어**
- **Mart 디렉토리**
- **Maps 디렉토리**

이 영역에는 향후 통합될 **레거시 코드**가 포함되어 있습니다.
여기에 새 파일을 추가해서는 안 됩니다.

---

## LLM 사용 참고 사항
- 이 문서를 dbt 구조의 **진실의 원천(source of truth)**으로 사용합니다.
- 쿼리를 생성할 때 **레이어 경계**를 준수합니다.
- **리포팅 레이어**의 지표만 노출합니다.
- **컬럼 정의**가 YAML 명세와 일치하는지 확인합니다.
- 제한 영역에 새 파일을 생성하거나 제안하지 **않습니다**.
- 스테이징과 모델에서 **중복 파일**을 피합니다.
- 가능하면 기존 리포팅 테이블에 **컬럼을 추가**하는 것을 선호합니다.

---

## 데이터 흐름 예시
**원시 소스 → 스테이징 → 모델 → 코어 → 리포팅**

---
